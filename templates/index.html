<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ config.nombre_plataforma }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --iica-azul: #0056b3;
            --iica-verde: #28a745;
            --iica-naranja: #fd7e14;
            --iica-gris: #6c757d;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--iica-azul), #003d82);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .hero-section {
            background: linear-gradient(135deg, var(--iica-azul), var(--iica-verde));
            color: white;
            padding: 80px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="white" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="white" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            opacity: 0.3;
        }
        
        .hero-content {
            position: relative;
            z-index: 2;
        }
        
        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--iica-azul);
            transition: transform 0.3s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-5px);
        }
        
        .fondo-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 5px solid var(--iica-verde);
            transition: all 0.3s ease;
        }
        
        .fondo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .fondo-card.urgente {
            border-left-color: #dc3545;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        .btn-iica {
            background: linear-gradient(135deg, var(--iica-azul), var(--iica-verde));
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-iica:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
        
        .badge-prioridad {
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .badge-prioridad.alta {
            background: #dc3545;
            color: white;
        }
        
        .badge-prioridad.media {
            background: #ffc107;
            color: #000;
        }
        
        .badge-prioridad.baja {
            background: #6c757d;
            color: white;
        }
        
        .recordatorio-card {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .recordatorio-card.urgente {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border-color: #dc3545;
        }
        
        .footer {
            background: linear-gradient(135deg, #343a40, #495057);
            color: white;
            padding: 40px 0;
            margin-top: 60px;
        }
        
        .logo-iica {
            max-height: 60px;
            margin-right: 15px;
        }
        
        .quick-actions {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .action-btn {
            background: linear-gradient(135deg, var(--iica-azul), var(--iica-verde));
            border: none;
            border-radius: 15px;
            padding: 15px 25px;
            color: white;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="/static/logo_iica.svg" alt="IICA Chile" class="logo-iica">
                IICA Chile - Portal de Financiamiento
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="/">Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/fondos">Todos los Fondos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/exportar">Exportar Excel</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="actualizarFondos()">Actualizar</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="hero-content">
                <h1 class="display-4 fw-bold mb-4">
                    <i class="fas fa-search-dollar me-3"></i>
                    Portal de Oportunidades de Financiamiento
                </h1>
                <p class="lead mb-4">
                    Sistema automatizado de detección de fondos nacionales e internacionales para IICA Chile
                </p>
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="input-group input-group-lg">
                            <input type="text" class="form-control" placeholder="Buscar fondos por nombre, organización o área..." id="searchInput">
                            <button class="btn btn-light" type="button" onclick="buscarFondos()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Estadísticas -->
    <section class="container my-5">
        <div class="row">
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-folder-open fa-3x text-primary mb-3"></i>
                    <h3 id="totalFondos">-</h3>
                    <p class="mb-0">Total Fondos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-clock fa-3x text-warning mb-3"></i>
                    <h3 id="fondosAbiertos">-</h3>
                    <p class="mb-0">Fondos Abiertos</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-flag fa-3x text-success mb-3"></i>
                    <h3 id="fondosNacionales">-</h3>
                    <p class="mb-0">Fondos Nacionales</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card text-center">
                    <i class="fas fa-globe fa-3x text-info mb-3"></i>
                    <h3 id="fondosInternacionales">-</h3>
                    <p class="mb-0">Fondos Internacionales</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Recordatorios Urgentes -->
    {% if recordatorios %}
    <section class="container my-5">
        <h3 class="mb-4">
            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
            Recordatorios de Plazos
        </h3>
        <div class="row">
            {% for recordatorio in recordatorios %}
            <div class="col-md-4">
                <div class="recordatorio-card {% if recordatorio.urgente %}urgente{% endif %}">
                    <h6 class="fw-bold">{{ recordatorio.fondo.nombre }}</h6>
                    <p class="mb-2">{{ recordatorio.fondo.organizacion }}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge {% if recordatorio.urgente %}bg-danger{% else %}bg-warning{% endif %}">
                            {{ recordatorio.dias_restantes }} días restantes
                        </span>
                        <a href="/fondo/{{ recordatorio.fondo.id }}" class="btn btn-sm btn-outline-primary">
                            Ver Detalles
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- Fondos Abiertos Prioritarios -->
    <section class="container my-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3>
                <i class="fas fa-star text-warning me-2"></i>
                Fondos Abiertos Prioritarios
            </h3>
            <a href="/fondos" class="btn btn-iica">
                <i class="fas fa-eye me-1"></i>Ver Todos
            </a>
        </div>
        
        <div class="row">
            {% for fondo in fondos_abiertos %}
            <div class="col-md-6 col-lg-4">
                <div class="fondo-card {% if fondo.prioridad == 'Alta' %}urgente{% endif %}">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <h5 class="mb-0">{{ fondo.nombre }}</h5>
                        <span class="badge-prioridad {{ fondo.prioridad.lower() }}">
                            {{ fondo.prioridad }}
                        </span>
                    </div>
                    
                    <p class="text-muted mb-2">
                        <i class="fas fa-building me-1"></i>{{ fondo.organizacion }}
                    </p>
                    
                    <p class="mb-3">{{ fondo.descripcion[:100] }}...</p>
                    
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong class="text-success">{{ fondo.monto }}</strong>
                        </div>
                        <div class="col-6 text-end">
                            <small class="text-muted">
                                <i class="fas fa-calendar me-1"></i>{{ fondo.fecha_cierre }}
                            </small>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <span class="badge bg-primary">{{ fondo.area }}</span>
                        <div>
                            <a href="/fondo/{{ fondo.id }}" class="btn btn-sm btn-outline-primary me-1">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="/postular/{{ fondo.id }}" class="btn btn-sm btn-iica">
                                <i class="fas fa-paper-plane"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>

    <!-- Acciones Rápidas -->
    <section class="container my-5">
        <div class="quick-actions">
            <h3 class="text-center mb-4">
                <i class="fas fa-bolt text-warning me-2"></i>
                Acciones Rápidas
            </h3>
            <div class="text-center">
                <a href="/fondos?tipo=Nacional" class="action-btn">
                    <i class="fas fa-flag me-2"></i>Fondos Nacionales
                </a>
                <a href="/fondos?tipo=Internacional" class="action-btn">
                    <i class="fas fa-globe me-2"></i>Fondos Internacionales
                </a>
                <a href="/fondos?estado=Abierto" class="action-btn">
                    <i class="fas fa-clock me-2"></i>Fondos Abiertos
                </a>
                <a href="/exportar" class="action-btn">
                    <i class="fas fa-download me-2"></i>Exportar Excel
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>IICA Chile</h5>
                    <p>Portal de Oportunidades de Financiamiento</p>
                    <p><strong>Misión:</strong> Facilitar el acceso a fondos para el desarrollo agrícola y rural</p>
                </div>
                <div class="col-md-6 text-end">
                    <h6>Enlaces Institucionales</h6>
                    <a href="#" class="text-light me-3">Sitio Web IICA</a>
                    <a href="#" class="text-light me-3">Redes Sociales</a>
                    <a href="#" class="text-light">Contacto</a>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center">
                <p>&copy; 2025 IICA Chile. Todos los derechos reservados.</p>
                <small>Versión {{ config.version }} - Última actualización: {{ config.ultima_actualizacion }}</small>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Cargar estadísticas
        function cargarEstadisticas() {
            fetch('/api/estadisticas')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('totalFondos').textContent = data.total_fondos;
                    document.getElementById('fondosAbiertos').textContent = data.fondos_abiertos;
                    document.getElementById('fondosNacionales').textContent = data.fondos_nacionales;
                    document.getElementById('fondosInternacionales').textContent = data.fondos_internacionales;
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Buscar fondos
        function buscarFondos() {
            const query = document.getElementById('searchInput').value;
            if (query.trim()) {
                window.location.href = `/fondos?q=${encodeURIComponent(query)}`;
            }
        }
        
        // Actualizar fondos
        function actualizarFondos() {
            if (confirm('¿Desea actualizar todos los fondos? Esto puede tomar unos minutos.')) {
                fetch('/actualizar', { method: 'POST' })
                    .then(response => {
                        if (response.ok) {
                            location.reload();
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }
        
        // Buscar con Enter
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                buscarFondos();
            }
        });
        
        // Cargar al iniciar
        document.addEventListener('DOMContentLoaded', cargarEstadisticas);
    </script>
</body>
</html>